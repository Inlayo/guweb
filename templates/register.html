<!-- HTML Meta Tags -->
<meta name="description" content="Register on Inlayo" />

<!-- Google / Search Engine Tags -->
<meta itemprop="name" content="Register - Inlayo" />
<meta itemprop="description" content="Log on Inlayo" />
<meta itemprop="image" content="https://{{ domain() }}/static/favicon/android-chrome-256x256.png" />

<!-- Facebook Meta Tags -->
<meta property="og:url" content="https://{{ domain() }}/register" />
<meta property="og:type" content="website" />
<meta property="og:title" content="Register - Inlayo" />
<meta property="og:description" content="Log on Inlayo" />
<meta property="og:image" content="https://{{ domain() }}/static/favicon/android-chrome-256x256.png" />

<!-- Twitter Meta Tags -->
<meta name="twitter:title" content="Register - Inlayo" />
<meta name="twitter:description" content="Log on Inlayo" />
<meta name="twitter:image" content="https://{{ domain() }}/static/favicon/android-chrome-256x256.png" />

{% extends "base.html" %} {% block title %} Register {% endblock %} {% block header %}
<link rel="stylesheet" href="/static/css/pages/auth.css" />
{% endblock %} {% block content %}
<style>
  .my-con {
    margin-top: 18vh;
  }
</style>

<script>
async function sendVerificationEmail() {
  var emailInput = document.getElementById("email");
  var email = emailInput.value.trim().toLowerCase();
  var sendBtn = document.getElementById("send-btn");
  var registerBtn = document.getElementById("register-btn");

  if (!email) {
    alert("Please enter a valid email address.");
    return;
  }

  const formData = new FormData();
  formData.append("email", email);

  try {
    const response = await fetch("/register_emailcheck", {
      method: "POST",
      body: formData,
    });

    if (!response.ok) {
      throw new Error("Server responded with an error.");
    }

    const data = await response.text();

    if (data === "exist") {
      emailInput.value = "";
      alert("This email is already registered.");
    } else if (data === "sent") {
      alert("Verification email sent successfully!");
      sendBtn.disabled = true;
      registerBtn.disabled = false;
    } else if (!isNaN(data)) {
      alert(`Verification email has been sent. You can try again in ${data} seconds.`);
      sendBtn.disabled = true;
      registerBtn.disabled = false;
    } else {
      alert("Failed to send verification email.");
    }
  } catch (error) {
    console.error("Error:", error);
    alert("An error occurred. Please try again later.");
  }
}
</script>

<div class="main-block is-marginless is-paddingless is-auth">
  <div class="columns pm-reset is-weeb">
    <div class="column title-block">
      <h1 class="title" id="regtitle">Registration</h1>
    </div>
  </div>
  <div class="columns pm-reset flex-lcenter is-block">
    <div class="box">
      <div class="login-bg"></div>
      <form action="/register" method="post" class="form-content">
        <div class="field">
          <label for="user" class="label">Username</label>
          <div class="control has-icons-left">
            <input id="user" type="text" name="username" placeholder="e.g. Inlayo" class="input" autocomplete="username"
              required />
            <span class="icon is-small is-left">
              <i class="fa fa-envelope"></i>
            </span>
          </div>
        </div>
        <div class="field">
          <label for="email" class="label">Email</label>
          <div class="control has-icons-left is-expanded">
            <input id="email" type="email" name="email" placeholder="e.g. inla@inla.kr" class="input"
              autocomplete="email" required />
            <span class="icon is-small is-left">
              <i class="fa fa-lock"></i>
            </span>
            <button id="send-btn" type="button" class="button is-send" onclick="sendVerificationEmail()" a>
              Send
            </button>
          </div>
        </div>
        <div class="field">
          <label for="verification" class="label">Email Verification</label>
          <div class="control has-icons-left">
            <input id="verification" type="text" name="emailkey" placeholder="*************" class="input" required />
            <span class="icon is-small is-left">
              <i class="fa fa-lock"></i>
            </span>
          </div>
        </div>
        <div class="field">
          <label for="pass" class="label">Password</label>
          <div class="control has-icons-left">
            <input id="pass" type="password" name="password" placeholder="*************" class="input"
              autocomplete="new-password" required />
            <span class="icon is-small is-left">
              <i class="fa fa-lock"></i>
            </span>
          </div>
        </div>
        <div class="field">
          <label for="pass" class="label">Confirm Password</label>
          <div class="control has-icons-left">
            <input id="pass" type="password" name="confirm_password" placeholder="*************" class="input"
              autocomplete="new-password" required />
            <span class="icon is-small is-left">
              <i class="fa fa-lock"></i>
            </span>
          </div>
        </div>
        <div class="mt-5"></div>
        <div class="dialog">
          Already have an account? <a href="/login">Login</a>
        </div>
        {% if not captchaKey() == 'changeme' %}
        <div class="field">
          <div class="h-captcha" data-sitekey="{{ captchaKey() }}" data-theme="dark"
            style="display: flex; justify-content: center"></div>
        </div>
        {% endif %}
        <div class="field">
          <button id="register-btn" type="submit" class="button is-primary" disabled>Register</button>
        </div>
      </form>
    </div>
  </div>
</div>

{% if flash %}
<div class="paper-snackbar is-{{ status }}" style="opacity: 1">{{ flash }}</div>
{% endif %} {% if not captchaKey() == 'changeme' %}
<script src="https://hcaptcha.com/1/api.js" async defer></script>
{% endif %} {% endblock %}